<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>JS Quest Blocks</title>
  <style>
    :root {
      --bg: #12182b;
      --panel: #1f2a44;
      --panel-light: #2a3860;
      --accent: #49dcb1;
      --accent-2: #68a5ff;
      --text: #f8fbff;
      --warn: #ffd166;
      --good: #8cff98;
      --bad: #ff8fa3;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: "Trebuchet MS", "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #202d52 10%, var(--bg) 65%);
      color: var(--text);
      min-height: 100vh;
      padding: 16px;
    }

    h1,h2,h3,p { margin: 0; }

    .app {
      max-width: 1200px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: 260px 1fr 320px;
      gap: 16px;
    }

    .panel {
      background: linear-gradient(165deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 16px;
      padding: 14px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.25);
    }

    .title {
      font-size: 1.35rem;
      margin-bottom: 6px;
    }

    .subtitle {
      opacity: 0.85;
      margin-bottom: 14px;
      font-size: 0.95rem;
      line-height: 1.4;
    }

    .block {
      width: 100%;
      margin: 8px 0;
      padding: 11px;
      border: none;
      border-radius: 12px;
      color: #091124;
      text-align: left;
      cursor: pointer;
      font-weight: 700;
      transition: transform .12s ease, filter .12s ease;
    }

    .block:hover { transform: translateY(-1px); filter: brightness(1.03); }
    .move { background: #66d9ff; }
    .turn { background: #ff9eea; }
    .jump { background: #ffe27a; }
    .repeat { background: #ffbe85; }
    .ifcoin { background: #8cff98; }

    .workspace-title {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    #programList {
      min-height: 220px;
      background: rgba(0,0,0,0.2);
      border: 2px dashed rgba(255,255,255,0.2);
      border-radius: 12px;
      padding: 10px;
      list-style: none;
      margin: 0;
      overflow: auto;
      max-height: 280px;
    }

    .step {
      background: var(--panel-light);
      border-radius: 10px;
      padding: 9px 11px;
      margin: 8px 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      font-weight: 700;
    }

    .step button {
      border: none;
      background: rgba(255,255,255,0.12);
      color: #fff;
      border-radius: 8px;
      cursor: pointer;
      padding: 3px 8px;
    }

    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 12px;
    }

    .controls button {
      border: none;
      border-radius: 11px;
      padding: 10px 14px;
      font-weight: 700;
      cursor: pointer;
    }

    #runBtn { background: var(--accent); color: #062319; }
    #clearBtn { background: #ff8fa3; color: #361019; }
    #loadHintBtn { background: var(--warn); color: #2f2302; }

    .stage-wrap {
      margin-top: 16px;
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
    }

    #stage {
      width: 100%;
      max-width: 520px;
      aspect-ratio: 13 / 8;
      background: linear-gradient(to bottom, #b9ecff, #89d4f8 40%, #57b85a 40%, #56a556);
      border-radius: 12px;
      border: 3px solid rgba(255,255,255,0.5);
      position: relative;
      overflow: hidden;
    }

    #player {
      width: 46px;
      height: 46px;
      border-radius: 12px;
      background: linear-gradient(145deg, #845ef7, #5f3dc4);
      color: white;
      font-size: 1.5rem;
      display: grid;
      place-items: center;
      position: absolute;
      left: 18px;
      top: calc(100% - 70px);
      transition: left .35s ease, top .35s ease, transform .3s ease;
      box-shadow: 0 8px 16px rgba(0,0,0,0.28);
    }

    #coin {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      position: absolute;
      right: 42px;
      top: calc(100% - 62px);
      background: radial-gradient(circle at 30% 30%, #fff4a0 10%, #ffcc3f 40%, #e59d00 70%);
      box-shadow: 0 0 10px rgba(255,220,92,0.9);
    }

    #log {
      min-height: 86px;
      background: rgba(0,0,0,0.25);
      border-radius: 10px;
      padding: 10px;
      line-height: 1.4;
      font-size: 0.94rem;
    }

    .lesson {
      display: grid;
      gap: 10px;
      font-size: .95rem;
      line-height: 1.35;
    }

    .lesson code {
      background: rgba(0,0,0,0.28);
      padding: 2px 6px;
      border-radius: 6px;
    }

    .chip {
      display: inline-block;
      background: rgba(255,255,255,0.13);
      border: 1px solid rgba(255,255,255,0.22);
      padding: 3px 8px;
      border-radius: 999px;
      font-size: .78rem;
      margin-top: 6px;
    }

    .success { color: var(--good); }
    .fail { color: var(--bad); }

    @media (max-width: 1080px) {
      .app { grid-template-columns: 1fr; }
      #stage { max-width: 100%; }
    }
  </style>
</head>
<body>
  <div class="app">
    <aside class="panel">
      <h1 class="title">üß† JS Quest Blocks</h1>
      <p class="subtitle">A Scratch-style mini game to learn how JavaScript logic works. Click blocks to build your code!</p>

      <button class="block move" data-cmd="move">‚û°Ô∏è moveRight()</button>
      <button class="block turn" data-cmd="turn">üîÅ turnAround()</button>
      <button class="block jump" data-cmd="jump">ü¶ò jump()</button>
      <button class="block repeat" data-cmd="repeat">üîÇ repeat 2x { moveRight }</button>
      <button class="block ifcoin" data-cmd="ifcoin">ü™ô if (nearCoin) { dance }</button>

      <p class="chip">Goal: Get the purple hero to the coin!</p>
    </aside>

    <main class="panel">
      <div class="workspace-title">
        <h2>Program Workspace</h2>
        <span id="lineCount">0 blocks</span>
      </div>
      <ul id="programList"></ul>

      <div class="controls">
        <button id="runBtn">‚ñ∂Ô∏è Run Program</button>
        <button id="clearBtn">üßπ Clear</button>
        <button id="loadHintBtn">üí° Load Hint Program</button>
      </div>

      <div class="stage-wrap">
        <h3>Game Stage</h3>
        <div id="stage">
          <div id="player">ü§ñ</div>
          <div id="coin" aria-label="coin"></div>
        </div>
        <div id="log">Ready! Build a program and press <strong>Run Program</strong>.</div>
      </div>
    </main>

    <section class="panel lesson">
      <h2>How this teaches JavaScript</h2>
      <p><strong>Sequence:</strong> Blocks run top-to-bottom, like lines in a script.</p>
      <p><strong>Functions:</strong> Each block calls an action, similar to <code>moveRight()</code>.</p>
      <p><strong>Loops:</strong> <code>repeat 2x</code> is like <code>for (let i = 0; i &lt; 2; i++)</code>.</p>
      <p><strong>Conditionals:</strong> <code>if (nearCoin)</code> only runs when true.</p>
      <hr style="width:100%; border-color: rgba(255,255,255,0.2);" />
      <h3>Challenge</h3>
      <p>Use as few blocks as possible to reach the coin and celebrate with a dance üíÉ.</p>
      <p id="scoreLine">Best score: <strong>Not set</strong></p>
    </section>
  </div>

  <script>
    const program = [];
    const hints = ["repeat", "move", "move", "ifcoin"];
    const ui = {
      list: document.getElementById("programList"),
      lineCount: document.getElementById("lineCount"),
      log: document.getElementById("log"),
      player: document.getElementById("player"),
      coin: document.getElementById("coin"),
      scoreLine: document.getElementById("scoreLine")
    };

    let state = { x: 0, facing: 1, yOffset: 0, hasCoin: false, busy: false };
    const targetX = 5;

    function renderProgram() {
      ui.list.innerHTML = "";
      program.forEach((cmd, idx) => {
        const li = document.createElement("li");
        li.className = "step";
        li.innerHTML = `<span>${idx + 1}. ${labelFor(cmd)}</span>`;

        const removeBtn = document.createElement("button");
        removeBtn.textContent = "‚úñ";
        removeBtn.title = "Remove block";
        removeBtn.addEventListener("click", () => {
          program.splice(idx, 1);
          renderProgram();
        });
        li.appendChild(removeBtn);
        ui.list.appendChild(li);
      });

      ui.lineCount.textContent = `${program.length} block${program.length === 1 ? "" : "s"}`;
      if (!program.length) {
        const helper = document.createElement("li");
        helper.style.opacity = "0.7";
        helper.style.padding = "6px";
        helper.textContent = "No blocks yet. Click a block on the left to start!";
        ui.list.appendChild(helper);
      }
    }

    function labelFor(cmd) {
      const map = {
        move: "moveRight()",
        turn: "turnAround()",
        jump: "jump()",
        repeat: "repeat 2x { moveRight() }",
        ifcoin: "if (nearCoin) { dance() }"
      };
      return map[cmd] || cmd;
    }

    function syncPlayer() {
      const baseLeft = 18;
      const step = 82;
      ui.player.style.left = `${baseLeft + state.x * step}px`;
      ui.player.style.top = `calc(100% - ${70 + state.yOffset}px)`;
      ui.player.style.transform = `scaleX(${state.facing})`;

      if (!state.hasCoin && state.x >= targetX) {
        state.hasCoin = true;
        ui.coin.style.display = "none";
      }
    }

    function pause(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }

    async function moveRight() {
      state.x = Math.min(state.x + 1, targetX);
      syncPlayer();
      await pause(380);
    }

    async function turnAround() {
      state.facing *= -1;
      syncPlayer();
      await pause(280);
    }

    async function jump() {
      state.yOffset = 48;
      syncPlayer();
      await pause(210);
      state.yOffset = 0;
      syncPlayer();
      await pause(190);
    }

    async function dance() {
      for (let i = 0; i < 3; i++) {
        state.facing *= -1;
        syncPlayer();
        await pause(140);
      }
    }

    function nearCoin() {
      return state.x >= targetX;
    }

    async function runCommand(cmd) {
      if (cmd === "move") return moveRight();
      if (cmd === "turn") return turnAround();
      if (cmd === "jump") return jump();
      if (cmd === "repeat") {
        for (let i = 0; i < 2; i++) await moveRight();
        return;
      }
      if (cmd === "ifcoin") {
        if (nearCoin()) {
          await dance();
          writeLog("Condition true: nearCoin detected, so dance() ran!", "success");
        } else {
          writeLog("Condition false: nearCoin is not true yet.", "fail");
        }
      }
    }

    function resetStage() {
      state = { x: 0, facing: 1, yOffset: 0, hasCoin: false, busy: false };
      ui.coin.style.display = "block";
      syncPlayer();
    }

    function writeLog(text, tone = "") {
      ui.log.innerHTML = `<span class="${tone}">${text}</span>`;
    }

    function setBestScore() {
      const previous = Number(localStorage.getItem("jsQuestBest") || "0");
      if (!previous || program.length < previous) {
        localStorage.setItem("jsQuestBest", String(program.length));
      }
      const best = localStorage.getItem("jsQuestBest");
      ui.scoreLine.innerHTML = `Best score: <strong>${best} block${best === "1" ? "" : "s"}</strong>`;
    }

    async function runProgram() {
      if (!program.length) {
        writeLog("Your program is empty. Add at least one block!", "fail");
        return;
      }
      if (state.busy) return;
      state.busy = true;
      resetStage();
      writeLog("Running program...", "");

      for (const cmd of program) {
        await runCommand(cmd);
      }

      if (state.hasCoin) {
        writeLog("Great job! You reached the coin and used JavaScript logic!", "success");
        setBestScore();
      } else {
        writeLog("Almost! Try adding more movement or a repeat loop.", "fail");
      }

      state.busy = false;
    }

    document.querySelectorAll(".block").forEach(btn => {
      btn.addEventListener("click", () => {
        if (state.busy) return;
        program.push(btn.dataset.cmd);
        renderProgram();
      });
    });

    document.getElementById("clearBtn").addEventListener("click", () => {
      if (state.busy) return;
      program.length = 0;
      renderProgram();
      resetStage();
      writeLog("Workspace cleared.", "");
    });

    document.getElementById("loadHintBtn").addEventListener("click", () => {
      if (state.busy) return;
      program.length = 0;
      program.push(...hints);
      renderProgram();
      writeLog("Hint loaded! Press Run Program to watch it.", "");
    });

    document.getElementById("runBtn").addEventListener("click", runProgram);

    setBestScore();
    renderProgram();
    resetStage();
  </script>
</body>
</html>
